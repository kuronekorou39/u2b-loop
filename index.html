<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#e94560">
    <meta name="description" content="YouTube & Local Video A-B Loop Player">
    <title>U2B-Loop</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="assets/favicon.png" type="image/png">
    <link rel="apple-touch-icon" href="assets/icon-512.png">
</head>
<body>
    <div class="container">
        <!-- ヘッダー（タイトル + レイアウト切替 + URL入力トグル） -->
        <header class="header">
            <a href="./" class="logo-link">
                <img src="assets/logo.png" alt="U2B-Loop" class="header-logo">
            </a>
            <div class="header-buttons">
                <button id="toggleUrlBtn" class="header-toggle show" title="動画を読み込む">
                    <span class="toggle-text">読込</span>
                    <span class="toggle-arrow">▼</span>
                </button>
                <button id="layoutBtn" class="header-btn" title="レイアウト切替">
                    <span class="btn-icon">⊟</span><span class="btn-label">並替</span>
                </button>
                <button id="historyBtn" class="header-btn" title="履歴">
                    <span class="btn-icon">◷</span><span class="btn-label">履歴</span>
                </button>
                <button id="themeBtn" class="header-btn" title="テーマ切替">
                    <span class="btn-icon">☀</span><span class="btn-label">色</span>
                </button>
                <!-- ショートカット（縦並び時：ヘッダーに表示） -->
                <div class="shortcut-accordion shortcut-in-header">
                    <button id="shortcutAccordionBtn" class="header-btn shortcut-accordion-btn" title="キーボードショートカット一覧">
                        <span class="btn-icon">⌨</span><span class="btn-label">Keys</span>
                    </button>
                    <div id="shortcutAccordionContent" class="shortcut-accordion-content">
                        <div class="shortcut-list-compact">
                            <div class="shortcut-item"><kbd>Space</kbd><span>再生</span></div>
                            <div class="shortcut-item"><kbd>←→</kbd><span>5秒</span></div>
                            <div class="shortcut-item"><kbd>A</kbd><span>A地点</span></div>
                            <div class="shortcut-item"><kbd>B</kbd><span>B地点</span></div>
                            <div class="shortcut-item"><kbd>L</kbd><span>ループ</span></div>
                            <div class="shortcut-item"><kbd>R</kbd><span>リセット</span></div>
                            <div class="shortcut-item"><kbd>M</kbd><span>ミュート</span></div>
                            <div class="shortcut-item"><kbd>F</kbd><span>全画面</span></div>
                            <div class="shortcut-item"><kbd>H</kbd><span>左右反転</span></div>
                            <div class="shortcut-item"><kbd>V</kbd><span>上下反転</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- 動画読み込み（折りたたみ） -->
        <div id="urlSection" class="url-section show">
            <!-- YouTube -->
            <div class="source-row">
                <span class="source-label">YouTube</span>
                <input type="text" id="videoUrl" placeholder="URLを貼り付け">
                <button id="loadBtn" class="load-btn">読込</button>
            </div>

            <!-- ローカルファイル -->
            <div class="source-row">
                <span class="source-label">ファイル</span>
                <label class="file-input-label">
                    <span id="fileNameDisplay">選択...</span>
                    <input type="file" id="localFileInput" accept="video/*" hidden>
                </label>
                <button id="loadFileBtn" class="load-btn">読込</button>
            </div>
        </div>

        <!-- メインコンテンツ（横並び対応） -->
        <div class="main-content">
            <!-- 左パネル: 動画 + コントロール -->
            <div class="left-panel">
                <!-- 動画プレーヤー + オーバーレイコントローラー -->
                <div class="player-wrapper" id="playerWrapper">
                    <div id="playerContainer" class="player-container">
                        <div id="player"></div>
                        <video id="localVideo" style="display: none;"></video>
                    </div>

                    <!-- ドラッグ&ドロップオーバーレイ -->
                    <div id="dropZone" class="drop-zone">
                        <div class="drop-zone-content">
                            <span class="drop-icon">▼</span>
                            <span class="drop-text">ファイルをドロップ</span>
                        </div>
                    </div>

                    <!-- オーバーレイコントローラー（フルスクリーン時） -->
                    <div class="overlay-controls" id="overlayControls">
                        <div class="overlay-gradient"></div>
                        <div class="overlay-content">
                            <!-- シークバー -->
                            <div class="overlay-seekbar">
                                <span id="overlayCurrentTime" class="overlay-time">0:00</span>
                                <div class="overlay-seekbar-wrapper">
                                    <div id="overlayABRegion" class="overlay-ab-region"></div>
                                    <input type="range" id="overlaySeekbar" class="overlay-seekbar-input" min="0" max="100" value="0" step="0.1">
                                </div>
                                <span id="overlayDuration" class="overlay-time">0:00</span>
                            </div>
                            <!-- ボタン類 -->
                            <div class="overlay-buttons">
                                <button id="overlayPlayPauseBtn" class="overlay-btn play">▶</button>
                                <button id="overlayMuteBtn" class="overlay-btn">♪</button>
                                <select id="overlaySpeedSelect" class="overlay-select">
                                    <option value="0.25">0.25x</option>
                                    <option value="0.5">0.5x</option>
                                    <option value="0.75">0.75x</option>
                                    <option value="1" selected>1x</option>
                                    <option value="1.25">1.25x</option>
                                    <option value="1.5">1.5x</option>
                                    <option value="1.75">1.75x</option>
                                    <option value="2">2x</option>
                                </select>
                                <button id="overlayLoopBtn" class="overlay-btn">↻ OFF</button>
                                <button id="overlayExitBtn" class="overlay-btn exit">✕</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- メインシークバー + 時間 -->
                <div class="seekbar-section">
                    <span id="currentTime">0:00</span>
                    <div class="seekbar-wrapper">
                        <div id="seekbarABRegion" class="seekbar-ab-region"></div>
                        <input type="range" id="seekbar" min="0" max="100" value="0" step="0.1">
                    </div>
                    <span id="duration">0:00</span>
                </div>

                <!-- コントロール行：再生 + 速度 + ミュート + 反転 -->
                <div class="controls-row">
                    <button id="playPauseBtn" class="play-btn" title="再生/一時停止 (Space)">▶</button>
                    <select id="speedSelect" title="再生速度">
                        <option value="0.25">0.25x</option>
                        <option value="0.5">0.5x</option>
                        <option value="0.75">0.75x</option>
                        <option value="1" selected>1x</option>
                        <option value="1.25">1.25x</option>
                        <option value="1.5">1.5x</option>
                        <option value="1.75">1.75x</option>
                        <option value="2">2x</option>
                    </select>
                    <button id="muteBtn" class="mute-btn" title="ミュート (M)">♪</button>
                    <div class="flip-buttons">
                        <button id="flipHorizontalBtn" class="flip-btn" title="左右反転 (H)">↔</button>
                        <button id="flipVerticalBtn" class="flip-btn" title="上下反転 (V)">↕</button>
                    </div>
                    <button id="fullscreenBtn" class="fullscreen-btn" title="フルスクリーン (F)">⛶</button>
                    <button id="ytControlsBtn" class="yt-controls-btn" title="YTコントローラー表示">≡</button>
                </div>
            </div>

            <!-- 右パネル: A-B区間ループ -->
            <div class="right-panel">
                <div class="loop-section">
            <!-- ループトグル -->
            <div class="loop-header">
                <button id="loopToggleBtn" class="loop-toggle-btn" title="ループ切替 (L)">
                    <span class="loop-icon">↻</span>
                    <span class="loop-text">ループ OFF</span>
                </button>
            </div>
            <div class="gap-control">
                <span id="gapCountdown" class="gap-countdown"></span>
                <span class="gap-label">空白</span>
                <div class="gap-buttons">
                    <button class="gap-btn active" data-gap="0">0</button>
                    <button class="gap-btn" data-gap="2">2</button>
                    <button class="gap-btn" data-gap="5">5</button>
                    <button class="gap-btn" data-gap="10">10</button>
                    <button class="gap-btn" data-gap="30">30</button>
                </div>
            </div>

            <!-- AB区間シークバー -->
            <div class="ab-seekbar-container">
                <div id="abSeekbar" class="ab-seekbar">
                    <div id="abRegion" class="ab-region"></div>
                    <div id="abCurrentPos" class="ab-current-pos"></div>
                    <div id="pointA" class="ab-point point-a"></div>
                    <div id="pointB" class="ab-point point-b"></div>
                </div>
            </div>

            <!-- AB設定カード -->
            <div class="ab-cards">
                <div class="ab-card card-a">
                    <div class="ab-card-header">
                        <span class="ab-label">A</span>
                        <span class="ab-card-title">開始</span>
                        <button id="resetPointABtn" class="reset-point-btn" title="リセット">✕</button>
                    </div>
                    <input type="text" id="pointAInput" class="ab-time-input" placeholder="0:00.000">
                    <div class="ab-controls">
                        <button id="pointAMinus" class="step-btn" title="A地点を戻す">−</button>
                        <button id="pointAPlus" class="step-btn" title="A地点を進める">+</button>
                        <select id="stepSelectA" class="step-select" title="調整幅">
                            <option value="0.001">0.001s</option>
                            <option value="0.01">0.01s</option>
                            <option value="0.1" selected>0.1s</option>
                            <option value="1">1s</option>
                        </select>
                        <button id="setPointABtn" class="set-current-btn" title="現在の再生位置をA地点に設定 (A)">現在</button>
                    </div>
                </div>
                <div class="ab-card card-b">
                    <div class="ab-card-header">
                        <span class="ab-label">B</span>
                        <span class="ab-card-title">終了</span>
                        <button id="resetPointBBtn" class="reset-point-btn" title="リセット">✕</button>
                    </div>
                    <input type="text" id="pointBInput" class="ab-time-input" placeholder="0:00.000">
                    <div class="ab-controls">
                        <button id="pointBMinus" class="step-btn" title="B地点を戻す">−</button>
                        <button id="pointBPlus" class="step-btn" title="B地点を進める">+</button>
                        <select id="stepSelectB" class="step-select" title="調整幅">
                            <option value="0.001">0.001s</option>
                            <option value="0.01">0.01s</option>
                            <option value="0.1" selected>0.1s</option>
                            <option value="1">1s</option>
                        </select>
                        <button id="setPointBBtn" class="set-current-btn" title="現在の再生位置をB地点に設定 (B)">現在</button>
                    </div>
                </div>
            </div>

            <!-- アクションボタン -->
            <div class="action-buttons">
                <button id="saveHistoryBtn" class="save-history-btn">履歴に保存</button>
                <button id="shareBtn" class="share-btn" title="AB区間の共有URLをコピー">
                    <span class="btn-icon">⛓</span><span class="btn-label">共有</span>
                </button>
            </div>
            </div>

            <!-- ショートカット（横並び時：right-panelに表示） -->
            <div class="shortcut-accordion shortcut-in-panel">
                <button class="shortcut-accordion-btn" data-shortcut-toggle>
                    <span class="shortcut-icon">⌨</span>
                    <span class="shortcut-label">Keys</span>
                    <span class="accordion-arrow">▼</span>
                </button>
                <div class="shortcut-accordion-content" data-shortcut-content>
                    <div class="shortcut-list-compact">
                        <div class="shortcut-item"><kbd>Space</kbd><span>再生</span></div>
                        <div class="shortcut-item"><kbd>←→</kbd><span>5秒</span></div>
                        <div class="shortcut-item"><kbd>A</kbd><span>A地点</span></div>
                        <div class="shortcut-item"><kbd>B</kbd><span>B地点</span></div>
                        <div class="shortcut-item"><kbd>L</kbd><span>ループ</span></div>
                        <div class="shortcut-item"><kbd>R</kbd><span>リセット</span></div>
                        <div class="shortcut-item"><kbd>M</kbd><span>ミュート</span></div>
                        <div class="shortcut-item"><kbd>F</kbd><span>全画面</span></div>
                        <div class="shortcut-item"><kbd>H</kbd><span>左右反転</span></div>
                        <div class="shortcut-item"><kbd>V</kbd><span>上下反転</span></div>
                    </div>
                </div>
            </div>
        </div>
        </div>

    </div>

    <!-- 履歴モーダル -->
    <div id="historyModal" class="history-modal">
        <div class="history-modal-content">
            <div class="history-modal-header">
                <h2>履歴</h2>
                <button id="closeHistoryBtn" class="history-close-btn">✕</button>
            </div>
            <div class="history-toolbar">
                <label class="history-import-btn">
                    ↑ 読込
                    <input type="file" id="importHistoryInput" accept=".json" hidden>
                </label>
                <button id="exportSelectBtn" class="history-export-btn">↓ 保存</button>
                <button id="clearAllHistoryBtn" class="history-clear-btn">✕ 全削除</button>
            </div>
            <div class="history-toolbar select-mode-toolbar" style="display: none;">
                <div class="select-mode-left">
                    <button id="selectAllBtn" class="select-all-btn">全選択</button>
                    <button id="deselectAllBtn" class="select-all-btn">全解除</button>
                </div>
                <span id="selectedCount" class="selected-count">0件選択中</span>
                <div class="select-mode-buttons">
                    <button id="cancelSelectBtn" class="select-cancel-btn">キャンセル</button>
                    <button id="exportSelectedBtn" class="select-export-btn" disabled>保存</button>
                </div>
            </div>
            <div id="historyList" class="history-list">
                <!-- 履歴アイテムがここに動的に追加される -->
            </div>
        </div>
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="app.js"></script>
    <script>
        // Service Worker 登録
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('U2B-Loop: Service Worker 登録成功');
                    })
                    .catch((error) => {
                        console.log('U2B-Loop: Service Worker 登録失敗:', error);
                    });
            });
        }
    </script>
</body>
</html>
